# 워크플로우의 이름
name: iOS CI

# 워크플로우가 실행될 조건
on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]

# 실행될 작업들의 목록
jobs:
  build-project:
    # 이 작업은 GitHub에서 제공하는 최신 macOS 환경에서 실행됨
    runs-on: macos-15

    # 작업 내에서 실행될 단계들
    steps:
      # 1. 레포지토리 코드 체크아웃
      - name: Checkout repository
        uses: actions/checkout@v4

#      # 2. (디버깅용) 러너에 설치된 Xcode 버전 목록 확인
#      - name: List available Xcode versions
#        run: ls /Applications | grep Xcode

#      # 3. 현재 선택된 Xcode 버전 확인
#      - name: Show current version of Xcode
#        run: xcodebuild -version

      # 4. 사용할 Xcode 버전 선택
      - name: Select Xcode version
        run: |
          sudo xcode-select -s /Applications/Xcode_16.0.app/Contents/Developer
          xcodebuild -version

#      # 5. 사용 가능한 시뮬레이터 목록 출력
#      - name: List available simulators
#        run: xcrun simctl list devices available

      # 6. 프로젝트 빌드 실행
      - name: Build Project
        working-directory: ./CaloLink
        run: |
          # test 대신 build 액션을 사용하여 컴파일만 진행
          # CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO 옵션으로 코드 서명을 비활성화
          xcodebuild build \
            -project CaloLink.xcodeproj \
            -scheme CaloLink \
            -destination 'platform=iOS Simulator,name=iPhone 16' \
            -skipPackagePluginValidation \
            -skipMacroValidation \
            CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO

#      # 6. 프로젝트 빌드 및 테스트 실행
#      - name: Build and Test (Inactive)
#        if: false # 이 단계를 실행하지 않도록 설정
#        working-directory: ./CaloLink
#        run: |
#          # 나중에 테스트 코드를 추가하면 아래 주석을 해제하고 위 'Build Project' 단계를 주석 처리하세요.
#          # xcodebuild test \
#          #   -project CaloLink.xcodeproj \
#          #   -scheme CaloLink \
#          #   -destination 'platform=iOS Simulator,name=iPhone 16,OS=latest' \
#          #   -skipPackagePluginValidation \
#          #   -skipMacroValidation \
#          #   CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO
